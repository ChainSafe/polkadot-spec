\documentclass{book}
\usepackage{plantuml} %%digarams

\begin{document}

\begin{figure}[h!]
\begin{plantuml}
@startuml

(*) --> "Collator produces PoV and parachain block" as START
--> "Send PoV to PV"
--> "PV validate the PoV block and produce the candidate receipt"
--> "Gossip candidate receipt and attestations among PoV" as GOSSIPCANDIDATE
--> "PVs provide attestations for candidate receipt generated by other PV"

--> if "Do we have enough attestations?" then
    --> [Yes] "Gossip Candidate receipt with enough attestations everyone" as GOSSIPENOUGHATT
else
    --> [No] GOSSIPCANDIDATE
endif

GOSSIPENOUGHATT --> "Candidate receipt and corresponding attestations are put on the relay chain" as split
--> "Parachain validators send out erasure coded pieces to all V"
--> "Validators vote on whether they have the erasure coded pieces for every current candidate" as merge

split --> merge

-left-> if "do 2/3 say on the relay chain that the erasure coded pieces are available" then
    --> [Yes] "The relay chain acts on the candidate receipt. The Parachain block happens on this fork" as split2
else
    [No] if "Has the block timed out after several block or a validators set change?" then
        --> [Yes] "Throw away this candidate receipt and start accepting alternative ones"
    else
        --> [No] merge
    endif
endif

START --> "Full nodes of the parachain execute the block if they have it..." as step
split2 -right-> step

split2 --> if "Every V decides whether to check this block?\\nHOW is charted somewhere else" then as temp
--> "The validator acquires the block"
--> "The validators validates the block and produces an attestation"

--> "Attestations and reports are gossiped and go onto the relay chain"
step --> "Attestations and reports are gossiped and go onto the relay chain" as step2

step2 --> temp


@enduml
\end{plantuml}
\caption{TODO}
\end{figure}

\end{document}