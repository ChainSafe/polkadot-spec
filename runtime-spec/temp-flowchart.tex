\documentclass{book}
\usepackage{plantuml} %%digarams

\begin{document}

\begin{figure}[h!]
\begin{plantuml}
@startuml

(*) --> "Collator produces PoV and parachain block" as START
-left-> "Send PoV to PV"
--> "PV validate the PoV block and produce the candidate receipt"
--> "Gossip candidate receipt and attestations among PoV" as GOSSIPCANDIDATE
--> "PVs provide attestations for candidate receipt generated by other PV"

-left-> if "Do we have enough attestations?" then
    --> [Yes] "Gossip Candidate receipt with enough attestations everyone" as GOSSIPENOUGHATT
else
    --> [No] GOSSIPCANDIDATE
endif

GOSSIPENOUGHATT --> "Candidate receipt and corresponding attestations are put on the relay chain" as split
--> "Parachain validators send out erasure coded pieces to all V"
--> "Validators vote on whether they have the erasure coded pieces for every current candidate" as merge

split --> merge

-left-> if "do 2/3 say on the relay chain that the erasure coded pieces are available" then
    --> [Yes] "The relay chain acts on the candidate receipt. The Parachain block happens on this fork" as split2
else
    [No] if "Has the block timed out after several block or a validators set change?" then
        --> [Yes] "Throw away this candidate receipt and start accepting alternative ones"
    else
        --> [No] merge
    endif
endif

START --> "Full nodes of the parachain execute the block if they have it..." as step
split2 -right-> step

split2 --> if "Every V decides whether to check this block?\\nHOW is charted somewhere else" as temp
--> "The validator acquires the block"
--> "The validators validates the block and produces an attestation"

--> "Attestations and reports are gossiped and go onto the relay chain" as step3
step --> step3

if "Did any validator say the block is invalid?" then
    --> [Yes] "Every validator acquires and checks the block"
    if "Do we decide that the block is invalid or valid? Slash the losing side if unambiguous" then
        --> [Valid] "We think the block is correct and can continue with GRANDPA"
    else
        --> [Invalid] "Oh no! Block is invalid. Abandon the fork"
    endif
else
    [No] if "Do enough validators sasy that the Parachain block is valid" then
        --> [Yes] "We think the block is correct and can continue with GRANDPA"
    else
        --> [No] step3
    endif
endif

@enduml
\end{plantuml}
\caption{TODO}
\end{figure}

\end{document}