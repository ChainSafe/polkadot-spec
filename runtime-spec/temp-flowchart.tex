\documentclass{book}
\usepackage{plantuml} %%digarams

\begin{document}

\begin{figure}[h!]
\begin{plantuml}
@startuml

(*) --> "Collator produces PoV and parachain block" as START
-right-> "Send PoV to PV"
--> "PV validate the PoV block and produce the candidate receipt"
--> "Gossip candidate receipt and attestations among PoV" as GOSSIPCANDIDATE
-right-> "PVs provide attestations for candidate receipt generated by other PV"

if "Do we have enough attestations?" then
    --> [Yes] "Gossip Candidate receipt with enough attestations everyone" as GOSSIPENOUGHATT
else
    --> [No] GOSSIPCANDIDATE
endif

GOSSIPENOUGHATT -down-> "Candidate receipt and corresponding attestations are put on the relay chain" as split
--> "Parachain validators send out erasure coded pieces to all V"
--> "Validators vote on whether they have the erasure coded pieces for every current candidate" as merge

split --> merge

if "do 2/3 say on the relay chain that the erasure coded pieces are available" then
    --> [Yes] "TODO"
else
    --> [No] "Has the block timed out after several block or a validators set change?"
endif

if "Has the block timed out after several block or a validators set change?" then
    --> [Yes] "Throw away this candidate receipt and start accepting alternative ones"
else
    --> [No] "Validators vote on whether they have the erasure coded pieces for every current candidate"
endif

START -down-> "Full nodes of the parachain execute the block if they have it..."

@enduml
\end{plantuml}
\caption{TODO}
\end{figure}

\end{document}